- name: Fetch RSS & send to Telegram
  run: |
    python << 'EOF'
    import requests, feedparser

    BOT_TOKEN = "${TG_BOT_TOKEN}"
    CHAT_ID = "${CHAT_ID}"

    # =========================
    # TEST PAKSA (WAJIB MASUK)
    # =========================
    test = requests.post(
        f"https://api.telegram.org/bot{BOT_TOKEN}/sendMessage",
        data={
            "chat_id": CHAT_ID,
            "text": "âœ… TEST BOT NETRAL NEWS â€” JIKA INI MUNCUL, BOT & CHANNEL AMAN"
        }
    )

    print("Test status:", test.status_code)
    print(test.text)

    # =========================
    # RSS (SETELAH TEST)
    # =========================
    RSS_FEEDS = [
        "https://rss.kompas.com/",
        "https://www.cnnindonesia.com/rss",
        "https://kbr.id/rss",
        "https://www.bola.com/rss"
    ]

    sent = 0

    for url in RSS_FEEDS:
        feed = feedparser.parse(url)
        for entry in feed.entries[:1]:
            title = entry.title
            link = entry.link
            summary = entry.get("summary") or entry.get("description") or ""
            summary = summary[:200]

            message = f"ðŸ“° {title}\n\n{summary}\n\nðŸ”— {link}"

            r = requests.post(
                f"https://api.telegram.org/bot{BOT_TOKEN}/sendMessage",
                data={
                    "chat_id": CHAT_ID,
                    "text": message
                }
            )

            if r.status_code == 200:
                sent += 1

    print("Total berita terkirim:", sent)
    EOF
