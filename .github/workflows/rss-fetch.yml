name: RSS to Telegram - Netral News

on:
  workflow_dispatch:
  schedule:
    - cron: "*/15 * * * *"

jobs:
  send:
    runs-on: ubuntu-latest

    steps:
    - name: Install dependencies
      run: pip install feedparser requests

    - name: Run RSS Sender
      env:
        BOT_TOKEN: ${{ secrets.TG_BOT_TOKEN }}
        CHAT_ID: "@netralnews_2026"
      run: |
        python3 - << 'EOF'
        import feedparser
        import requests

        RSS_URL = "https://www.antaranews.com/rss/terkini.xml"
        feed = feedparser.parse(RSS_URL)

        print("Jumlah entry:", len(feed.entries))

        if not feed.entries:
            print("RSS kosong")
            exit()

        latest = feed.entries[0]
        title = latest.title
        link = latest.link

        message = f"ðŸ“° {title}\n\nBaca selengkapnya:\n{link}"

        url = f"https://api.telegram.org/bot{BOT_TOKEN}/sendMessage"

        payload = {
            "chat_id": CHAT_ID,
            "text": message
        }

        r = requests.post(url, data=payload)
        print(r.status_code, r.text)
        EOF
