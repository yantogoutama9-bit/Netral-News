name: RSS Auto Post

on:
  workflow_dispatch:

jobs:
  send:
    runs-on: ubuntu-latest
    steps:
      - name: Install requests
        run: pip install requests

      - name: Send Latest RSS
        env:
          BOT_TOKEN: ${{ secrets.TG_BOT_TOKEN }}
          CHAT_ID: "@netralnews_2026"
        run: |
          python3 - << 'EOF'
          import requests
          import re

          rss_url = "https://www.antaranews.com/rss/terkini.xml"
          response = requests.get(rss_url, timeout=10)

          if response.status_code != 200:
              print("RSS gagal diakses")
              exit()

          content = response.text

          items = re.findall(r"<item>(.*?)</item>", content, re.DOTALL)
          if not items:
              print("Tidak ada item RSS")
              exit()

          first = items[0]

          title = re.search(r"<title>(.*?)</title>", first).group(1)
          link = re.search(r"<link>(.*?)</link>", first).group(1)

          message = f"{title}\n\n{link}"

          send_url = f"https://api.telegram.org/bot{BOT_TOKEN}/sendMessage"

          r = requests.post(send_url, data={
              "chat_id": CHAT_ID,
              "text": message
          })

          print(r.status_code, r.text)
          EOF
